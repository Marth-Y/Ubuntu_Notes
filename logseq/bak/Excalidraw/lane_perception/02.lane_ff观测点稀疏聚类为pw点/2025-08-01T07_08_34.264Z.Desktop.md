---
excalidraw-plugin: parsed
tags:
  - excalidraw
  - Work
---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠== You can decompress Drawing data with the command palette: 'Decompress current Excalidraw file'. For more info check in plugin settings under 'Saving'

#excalidraw #Work 
# Excalidraw Data

## Text Elements
SparseAndFitMapLines(const float start_x_thres,
                     const float end_x_thres,
                     const int   fit_degree)
{
    for (auto& kv : id_line_map_)
    {
        SparseOneLinePoints(kv.second, -1000.0f, 1000.0f);
        FitOneLine(kv.second, start_x_thres, end_x_thres, fit_degree);
    }
} ^cTbulNdT

采用的是基于纵向坐标（x轴）分段聚类+加权平均的方法进行聚类。

具体方法如下：
区间分段

先根据输入的点集，按照纵向坐标（body_pose_(0)，即x值）从大到小排序。
以 step=2.0f 米为分段长度，从起始点开始，每隔2米分一个区间。
区间内聚类

在每个 [left, right) 区间内，收集所有点。
对区间内的点，采用加权平均（权重为点的 weight_）计算聚类结果，包括位置、置信度等。
置信度加权

置信度采用权重平方加权平均，使得当前帧高置信度点影响更大。
聚类结果筛选

每个区间聚类后，如果聚类点数量和总权重大于阈值，则保留该聚类点作为稀疏点。
输出

最终输出的 pts_sparse 是每个区间的加权聚类点，代表稀疏化后的车道线点集。 ^owlrVXqC

%%
## Drawing
```compressed-json
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=
```
%%