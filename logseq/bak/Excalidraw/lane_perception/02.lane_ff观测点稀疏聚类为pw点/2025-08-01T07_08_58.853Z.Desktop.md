---
excalidraw-plugin: parsed
tags:
  - excalidraw
  - Work
---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠== You can decompress Drawing data with the command palette: 'Decompress current Excalidraw file'. For more info check in plugin settings under 'Saving'

#excalidraw #Work 
# Excalidraw Data

## Text Elements
SparseAndFitMapLines(const float start_x_thres,
                     const float end_x_thres,
                     const int   fit_degree)
{
    for (auto& kv : id_line_map_)
    {
        SparseOneLinePoints(kv.second, -1000.0f, 1000.0f);
        FitOneLine(kv.second, start_x_thres, end_x_thres, fit_degree);
    }
} ^cTbulNdT

采用的是基于纵向坐标（x轴）分段聚类+加权平均的方法进行聚类。

具体方法如下：
区间分段

先根据输入的点集，按照纵向坐标（body_pose_(0)，即x值）从大到小排序。
以 step=2.0f 米为分段长度，从起始点开始，每隔2米分一个区间。
区间内聚类

在每个 [left, right) 区间内，收集所有点。
对区间内的点，采用加权平均（权重为点的 weight_）计算聚类结果，包括位置、置信度等。
置信度加权

置信度采用权重平方加权平均，使得当前帧高置信度点影响更大。
聚类结果筛选

每个区间聚类后，如果聚类点数量和总权重大于阈值，则保留该聚类点作为稀疏点。
输出

最终输出的 pts_sparse 是每个区间的加权聚类点，代表稀疏化后的车道线点集。 ^owlrVXqC

%%
## Drawing
```compressed-json
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
```
%%