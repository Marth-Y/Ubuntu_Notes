---

excalidraw-plugin: parsed
tags: [excalidraw]

---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠==


# Excalidraw Data

## Text Elements
将不同相机的线合并为一个vector ^7PXuz2TO

将线分为topo相关线集合、topo无关的线 ^bjSLiT76

里面也会简要用横向线线(未关联的线与已关联的线)的距离，判断线是否应该与关键点关联 ^h9gwLw7p

ClassifyByTopoRelationship ^KaeRuNkH

DropBad:遍历所有线，根据起点距离自车的距离，设定线长阈值，超过线长则采用 ^tn7mBcFN

MergeRebuildFeatlinesInterface(topo_points,input_featlines_put_in_one_cam,merged_featlines) ^NepaHHSx

1. ReadTopoIdsFromInputFeatlines ^gn6TNvRB

遍历所有单帧的线得到关联的topo点，将点从近到远排序，最多取三个：sorted_topo_ids ^6j0yq2XK

2. 将上述sorted_topo_ids映射为topo_id到线的map。作为关联topo点的线集合，每根线只会和一个TOPO点绑定 ^XDYDpI1A

3. 遍历观测的线，尝试软关联，计算观测线与上述与topo点关联线的距离，距离近则认为也是关联的线，加入到对应的goup ^dzMqLx38

遍历 sorted_topo_ids，优先将已经绑定了 topo_id 的线分到对应 group，每条线只分到一个 group。 ^xyPmuc0q

std::map<int,std::vector<const FeatLine*>>& related_groups ^YmegYLem

4. 剩下的线全部归为无关线 ^cLZVI4Ng

%%
## Drawing
```compressed-json
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=
```
%%